---
- name: Install and configures SAMBA shares
  hosts: serverc
  tasks:
    - name: Ensure group "pirate" exists
      ansible.builtin.group:
        name: pirate
        state: present
    - name: Add system user 
      ansible.builtin.user:
        name: alice
        groups: pirate
        shell: /bin/bash
        append: yes
    - name: SMB install and config
      ansible.builtin.import_role:
        name: vladgh.samba.server
      vars:
        samba_users:
        - name: alice
          password: ecila
        samba_shares:
        - name: pirate
          group: pirate 
          write_list: +pirate
      notify:
        - set firewalld
  handlers:
    - name: set firewalld
      ansible.posix.firewalld:
        service: samba
        permanent: true
        state: enabled

- name: mount SAMBA share
  hosts: serverd
  tasks:
    - name: Install cifs-utils
      ansible.builtin.dnf:
        name: cifs-utils
        state: present
    - name: Make fstab entry and mount
      ansible.posix.mount:
        src: //serverc/pirate
        path: /mnt
        opts: user=alice,password=ecila
        state: mounted
        fstype: cifs

